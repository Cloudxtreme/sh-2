#!/usr/bin/env bash
# .sh/bin/setup-www 20170519 - 20180315
# Copyright (C) 1995-2018 Mark Constable <markc@renta.net> (AGPL-3.0)

[[ $1 =~ '-h' ]] && \
    echo "Usage: setup-www [domain] [mysql(default)|sqlite]" && exit 1

[[ $(id -u) -gt 0 ]] && echo "ERROR: must be root (use sudo)" && exit 2

source /root/.shrc || exit 3

if [[ -d $VPATH/$VHOST ]]; then
    echo "*** $VPATH/$VHOST already exists"
else
    echo "*** addvhost $VHOST"
    addvhost $VHOST
    newautoconfig $VHOST
    chperms $VHOST > /dev/null 2>&1
fi

systemd-cat -t hlog echo "$(whoami) $(basename $0) $*"
