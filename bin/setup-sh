#!/usr/bin/env bash
# .sh/bin/setup-sh 20170319 - 20170517
# Copyright (C) 2015-2017 Mark Constable <markc@renta.net> (AGPL-3.0)

ifconfig eth0 > /dev/null 2>&1
[[ $? -gt 0 ]] && echo "
    Hint: to change defalt Ubuntu eth-device back to eth0...
    sudo nano /etc/default/grub
    Change: GRUB_CMDLINE_LINUX=\"net.ifnames=0 biosdevname=0\"
    sudo grub-mkconfig -o /boot/grub/grub.cfg
    sudo systemctl reboot
    # and update references in /etc/network/interfaces (.d/)
"

grep -q '^#precedence ::ffff:0:0/96  100' /etc/gai.conf
if [[ $? -eq 0 ]]; then
    echo "!!! Warning: giving preference to IPv4 over IPv6 (Ubuntu default)"
    sed -i 's;#precedence ::ffff:0:0/96  100;precedence ::ffff:0:0/96  100;' /etc/gai.conf
fi

if [[ -d ~/.sh ]]; then
    echo "!!! Update local root shell"
    ~/.sh/bin/shm pull > /dev/null
    source ~/.shrc
    gethost > ~/.sh/lib/defaults
else
    echo "!!! Setup local root shell"
    cd
    git clone -q https://github.com/netserva/sh .sh
    ~/.sh/bin/shm install > /dev/null
    ~/.sh/bin/shm perms
    source ~/.shrc
    gethost > ~/.sh/lib/defaults
fi

gethost
